# bitcask-kv-go

æœ¬ä»“åº“æ˜¯ [Bitcask](https://riak.com/assets/bitcask-intro.pdf) é”®å€¼å­˜å‚¨æ¨¡å‹çš„ä¸€ä¸ª Go è¯­è¨€å®ç°ã€‚

Bitcask æ˜¯ä¸€ç§åŸºäºæ—¥å¿—ç»“æ„ï¼ˆLog-Structuredï¼‰çš„å“ˆå¸Œè¡¨ï¼Œä¸“ä¸ºå¿«é€Ÿçš„é”®å€¼æ•°æ®è¯»å†™è€Œè®¾è®¡ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ‰€æœ‰å†™æ“ä½œéƒ½ä»¥è¿½åŠ ï¼ˆAppend-onlyï¼‰çš„æ–¹å¼å†™å…¥æ–‡ä»¶ï¼Œä»è€Œè·å¾—æé«˜çš„å†™å…¥æ€§èƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

-   **é«˜æ€§èƒ½å†™å…¥**: æ‰€æœ‰å†™æ“ä½œå‡ä¸ºé¡ºåºè¿½åŠ ï¼Œé¿å…äº†éšæœº I/Oã€‚
-   **å¿«é€Ÿè¯»å–**: æ‰€æœ‰é”®çš„ç´¢å¼•éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¤§éƒ¨åˆ†è¯»æ“ä½œåªéœ€ä¸€æ¬¡ç£ç›˜å¯»é“ã€‚
-   **åŸå­æ“ä½œ**: `Put` å’Œ `Delete` æ“ä½œé€šè¿‡é”æœºåˆ¶ä¿è¯åŸå­æ€§ã€‚
-   **æ•°æ®æŒä¹…åŒ–**: æ”¯æŒåœ¨æ¯æ¬¡å†™å…¥åå°†æ•°æ®åŒæ­¥åˆ°ç£ç›˜ã€‚
-   **æ•°æ®æ–‡ä»¶è½®è½¬**: å½“æ´»è·ƒæ•°æ®æ–‡ä»¶è¾¾åˆ°é¢„è®¾é˜ˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ´»è·ƒæ–‡ä»¶ã€‚
-   **æ•°æ®åº“é‡å¯**: èƒ½å¤Ÿä»ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶é‡æ–°åŠ è½½å¹¶æ„å»ºå†…å­˜ç´¢å¼•ã€‚
-   **å¯æ’æ‹”ç´¢å¼•**: é€šè¿‡æ¥å£æŠ½è±¡ï¼Œç›®å‰æ”¯æŒ B-Tree ç´¢å¼•ï¼Œæœªæ¥å¯æ‰©å±•æ”¯æŒ ART ç­‰å…¶ä»–ç´¢å¼•ç»“æ„ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨ç¤ºä¾‹

```go
package main

import (
	bitcask "bitcask-kv-go"
	"fmt"
)

func main() {
	// ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå¯ä»¥è‡ªå®šä¹‰
	opts := bitcask.DefaultOptions
	// æŒ‡å®šæ•°æ®å­˜å‚¨ç›®å½•
	opts.DirPath = "/tmp/bitcask-data"
	
	// æ‰“å¼€æ•°æ®åº“
	db, err := bitcask.Open(opts)
	if err != nil {
		panic(err)
	}
	defer db.Close()

	// å†™å…¥æ•°æ®
	err = db.Put([]byte("name"), []byte("bitcask"))
	if err != nil {
		panic(err)
	}

	// è¯»å–æ•°æ®
	val, err := db.Get([]byte("name"))
	if err != nil {
		panic(err)
	}
	fmt.Println("val =", string(val)) // è¾“å‡º: val = bitcask

	// åˆ é™¤æ•°æ®
	err = db.Delete([]byte("name"))
	if err != nil {
		panic(err)
	}
    
    // å†æ¬¡è¯»å–
    _, err = db.Get([]byte("name"))
    fmt.Println(err) // è¾“å‡º: key not found
}
```

## ğŸ§ª è¿è¡Œæµ‹è¯•

æœ¬é¡¹ç›®åŒ…å«äº†ä¸°å¯Œçš„å•å…ƒæµ‹è¯•å’Œå¹¶å‘æµ‹è¯•ç”¨ä¾‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ `Makefile` æ¥æ–¹ä¾¿åœ°è¿è¡Œå®ƒä»¬ã€‚

```sh
# è¿è¡Œæ‰€æœ‰å¸¸è§„æµ‹è¯•
make test

# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶å¼€å¯ç«æ€æ£€æµ‹å™¨ï¼ˆæ¨èï¼‰
make test-race
```

## ğŸ“œ è®ºæ–‡å‚è€ƒ

Bitcask: A Log-Structured Hash Table for Fast Key/Value Data